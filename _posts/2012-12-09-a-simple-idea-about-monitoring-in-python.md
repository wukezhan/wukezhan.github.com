---
layout: post
title: 【想法】用python实现一个简单的摄像头闯入检测程序
categories: [ 想法, python ]
tags: [ python, 监控 ]
---

最近百无聊赖，觉得住处实在太闷了，于是周末都跑到公司消磨时间。

但是今天刚到公司不久，QQ弹窗提示我两个QQ在别的地方登录了。

因为我房间的门从来不锁，而且今天出门时电脑也未锁屏，所以合理怀疑是有人跑到房间玩电脑去了。

由此产生了一个想法，那就是用笔记本自带的摄像头实现一个闯入检测系统，以达到在线监控房间动态及预警的目的。


### 基本原理

1.  使用python相关类库实现定时从摄像头抓拍当前环境，并采用感知hash算法与前一次抓拍结果进行hash比对，如果二者汉明距离超过一定阈值，则判定检测到闯入，将本次抓拍结果保存至dropbox的Public/zmonitor路径下，否则将抓拍结果以一定频率保存到特定位置以供下一次比对使用；

2.  配置ifttt以对Public/zmonitor路径进行监控，一旦有新的抓拍照片保存并同步至dropbox，立即触发ifttt的短信报警或者自定义的邮件报警；

3.  收到报警后直接打开Public/zmonitor相关文件夹，即可查看即时环境状况。


### 一些可能用到的算法和机制

1.  斐波拉契算法：防空转，在和平环境下，可将抓拍频率适当减小，如10秒抓拍一次，当环境发生较大波动时，自动提高抓拍频率，如可将其调整为每秒抓拍一次；

2.  感知hash算法：实现简单的灰度、对比度处理，排除光线等因素的影响（不过按常理，10秒之内的亮度变化应该可以忽略不计）；

3.  抓拍照片以Y-m-d格式的文件夹分别存储，文件为H.i.s为文件名存储，以方便查看和后续可能的功能扩展。

### 可能用到的类库和网络资源

VideoCapture，PIL，pygame。

[如何使用Python操作摄像头](http://coolshell.cn/articles/1928.html)

[Python + Dropbox 打造简易版 WebCam](http://www.syncoo.com/webcam-with-python-and-dropbox.htm)
